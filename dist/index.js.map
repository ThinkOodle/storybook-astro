{"version":3,"sources":["../src/framework/vite-plugins.ts","../src/docs/sourceTransformer.ts","../src/integration/index.ts","../src/preset.ts"],"names":["require","__dirname","dirname","createRequire","join","createAstroVitePlugins"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Vite plugins for Astro Storybook integration\n * \n * Creates the necessary Vite plugins to:\n * 1. Handle Astro component imports via Astro's Vite plugin\n * 2. Set up WebSocket communication for rendering\n * 3. Inject global styles and scripts\n */\n\nimport type { Plugin, ViteDevServer, InlineConfig } from 'vite';\nimport type { FrameworkOptions, RenderRequestMessage, RenderResponseMessage } from '../types/index.js';\n\n// Cache the Astro Vite config to avoid recreating it\nlet cachedAstroViteConfig: InlineConfig | null = null;\n\n/**\n * Create all Vite plugins needed for Astro support in Storybook\n */\nexport async function createAstroVitePlugins(options: FrameworkOptions): Promise<Plugin[]> {\n  // Set VITEST env to trick Astro into compiling components for client-side rendering\n  // This works around the SSR check in astro:build plugin that would otherwise\n  // stub out components with an error\n  process.env.VITEST = 'true';\n  \n  // Get Astro's full Vite configuration including all plugins\n  const astroViteConfig = await getAstroViteConfig();\n  \n  // Extract plugins from Astro's config\n  const astroPlugins = extractAstroPlugins(astroViteConfig);\n  \n  return [\n    ...astroPlugins,\n    astroContainerPlugin(),\n    astroStylesPlugin(options.stylesheets || []),\n    astroScriptsPlugin(options.scripts || []),\n    astroComponentMarkerPlugin(),\n  ];\n}\n\n/**\n * Get the full Astro Vite configuration using getViteConfig\n */\nasync function getAstroViteConfig(): Promise<InlineConfig> {\n  if (cachedAstroViteConfig) {\n    return cachedAstroViteConfig;\n  }\n  \n  try {\n    const { getViteConfig } = await import('astro/config');\n    \n    // getViteConfig returns a function that takes { mode, command }\n    const configFn = getViteConfig({}, {\n      // Minimal inline Astro config - will use astro.config.mjs from project\n    });\n    \n    cachedAstroViteConfig = await configFn({ \n      mode: 'development', \n      command: 'serve' \n    });\n    \n    return cachedAstroViteConfig;\n  } catch (error) {\n    console.warn('[storybook-astro] Could not load Astro Vite config:', error);\n    return { plugins: [] };\n  }\n}\n\n/**\n * Extract relevant plugins from Astro's Vite configuration\n */\nfunction extractAstroPlugins(config: InlineConfig): Plugin[] {\n  if (!config.plugins) return [];\n  \n  // Flatten nested plugin arrays - use explicit typing to avoid deep recursion\n  const flatPlugins: unknown[] = [];\n  const flatten = (arr: unknown[]): void => {\n    for (const item of arr) {\n      if (Array.isArray(item)) {\n        flatten(item);\n      } else if (item) {\n        flatPlugins.push(item);\n      }\n    }\n  };\n  flatten(config.plugins as unknown[]);\n  \n  // Include plugins essential for .astro file compilation\n  const essentialPlugins = [\n    'astro:build',\n    'astro:build:normal', \n    'astro:config-alias',\n    'astro:load-fallback',\n    'astro:postprocess',\n    'astro:markdown',\n    'astro:html',\n    'astro:scripts',\n    'astro:assets',\n    'astro:head',\n    'astro:container',\n  ];\n  \n  return flatPlugins.filter((p): p is Plugin => {\n    if (!p || typeof p !== 'object') return false;\n    const name = 'name' in p ? String((p as { name: unknown }).name) : '';\n    return essentialPlugins.some(essential => name.startsWith(essential) || name === essential);\n  });\n}\n\n/**\n * Plugin that sets up the Astro Container API for server-side rendering\n * Handles WebSocket messages from the client to render components\n */\nfunction astroContainerPlugin(): Plugin {\n  let viteServer: ViteDevServer;\n  \n  return {\n    name: 'storybook-astro:container',\n    \n    configureServer(server) {\n      viteServer = server;\n      \n      // Handle render requests from the client\n      server.ws.on('astro:render:request', async (data: RenderRequestMessage['data'], client) => {\n        try {\n          const html = await renderAstroComponent(data, viteServer);\n          \n          const response: RenderResponseMessage['data'] = {\n            id: data.id,\n            html,\n          };\n          \n          client.send('astro:render:response', response);\n        } catch (error) {\n          const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n          console.error('[storybook-astro] Render error:', errorMessage);\n          \n          const response: RenderResponseMessage['data'] = {\n            id: data.id,\n            html: `<div style=\"color: #dc2626; background: #fef2f2; padding: 16px; border-radius: 8px; font-family: system-ui;\">\n              <strong>Render Error</strong>\n              <pre style=\"margin: 8px 0 0; white-space: pre-wrap;\">${escapeHtml(errorMessage)}</pre>\n            </div>`,\n            error: errorMessage,\n          };\n          \n          client.send('astro:render:response', response);\n        }\n      });\n    },\n  };\n}\n\n/**\n * Render an Astro component using the Container API\n */\nasync function renderAstroComponent(\n  data: RenderRequestMessage['data'],\n  server: ViteDevServer\n): Promise<string> {\n  // Dynamic import to get fresh module on HMR\n  const { experimental_AstroContainer: AstroContainer } = await import('astro/container');\n  \n  // Create container for rendering\n  const container = await AstroContainer.create({\n    // Resolve module paths for client-side scripts\n    resolve: async (specifier: string) => {\n      if (specifier.startsWith('astro:scripts')) {\n        return `/@id/${specifier}`;\n      }\n      return specifier;\n    },\n  });\n  \n  // Import the component module\n  const componentModule = await server.ssrLoadModule(data.component);\n  const Component = componentModule.default;\n  \n  if (!Component) {\n    throw new Error(`Component not found: ${data.component}`);\n  }\n  \n  // Render to string\n  const html = await container.renderToString(Component, {\n    props: data.args || {},\n    slots: data.slots || {},\n  });\n  \n  return html;\n}\n\n/**\n * Virtual module plugin for injecting global stylesheets\n */\nfunction astroStylesPlugin(stylesheets: string[]): Plugin {\n  const virtualModuleId = 'virtual:astro-storybook/styles';\n  const resolvedVirtualModuleId = '\\0' + virtualModuleId;\n  \n  return {\n    name: 'storybook-astro:styles',\n    \n    resolveId(id) {\n      if (id === virtualModuleId) {\n        return resolvedVirtualModuleId;\n      }\n    },\n    \n    load(id) {\n      if (id === resolvedVirtualModuleId) {\n        const normalized = stylesheets.map(s => normalizeAssetPath(s));\n        return `export const stylesheets = ${JSON.stringify(normalized)};`;\n      }\n    },\n  };\n}\n\n/**\n * Virtual module plugin for injecting global scripts\n */\nfunction astroScriptsPlugin(scripts: string[]): Plugin {\n  const virtualModuleId = 'virtual:astro-storybook/scripts';\n  const resolvedVirtualModuleId = '\\0' + virtualModuleId;\n  \n  return {\n    name: 'storybook-astro:scripts',\n    \n    resolveId(id) {\n      if (id === virtualModuleId) {\n        return resolvedVirtualModuleId;\n      }\n    },\n    \n    load(id) {\n      if (id === resolvedVirtualModuleId) {\n        const normalized = scripts.map(s => normalizeAssetPath(s));\n        return `export const scripts = ${JSON.stringify(normalized)};`;\n      }\n    },\n  };\n}\n\n/**\n * Plugin to mark Astro components with their module ID for rendering\n */\nfunction astroComponentMarkerPlugin(): Plugin {\n  return {\n    name: 'storybook-astro:component-marker',\n    enforce: 'post',\n    \n    transform(code, id) {\n      // Only process compiled .astro files\n      if (!id.endsWith('.astro') && !id.includes('.astro?')) {\n        return null;\n      }\n      \n      // Look for the default export and add moduleId\n      // Astro compiles components to have a default export\n      if (code.includes('export default') || code.includes('export { $$Component as default }')) {\n        const moduleIdLine = `\\n;(function() { \n          if (typeof $$Component !== 'undefined') { \n            $$Component.isAstroComponentFactory = true;\n            $$Component.moduleId = ${JSON.stringify(id.split('?')[0])}; \n          }\n        })();\\n`;\n        \n        return {\n          code: code + moduleIdLine,\n          map: null,\n        };\n      }\n      \n      return null;\n    },\n    \n    // Handle HMR for Astro components\n    handleHotUpdate({ file, server }) {\n      if (file.endsWith('.astro')) {\n        server.ws.send({\n          type: 'custom',\n          event: 'astro:component:update',\n          data: { file },\n        });\n      }\n    },\n  };\n}\n\n/**\n * Normalize asset paths for injection\n */\nfunction normalizeAssetPath(path: string): string {\n  // Keep absolute URLs as-is\n  if (/^https?:\\/\\//.test(path)) {\n    return path;\n  }\n  \n  // Remove leading ./ and ensure leading /\n  path = path.replace(/^\\.\\//, '');\n  if (!path.startsWith('/')) {\n    path = '/' + path;\n  }\n  \n  return path;\n}\n\n/**\n * Escape HTML special characters\n */\nfunction escapeHtml(text: string): string {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n","/**\n * Source code transformer for Astro components in Storybook docs\n * \n * Transforms story args into proper Astro component syntax for display\n * in the \"Show code\" panel.\n */\n\nexport interface StoryContext {\n  id: string;\n  name: string;\n  title: string;\n  component?: {\n    displayName?: string;\n    name?: string;\n    __docgenInfo?: {\n      displayName?: string;\n    };\n  } & ((...args: unknown[]) => unknown);\n  args: Record<string, unknown>;\n  parameters?: {\n    docs?: {\n      source?: {\n        code?: string;\n        language?: string;\n        excludeDecorators?: boolean;\n      };\n    };\n  };\n}\n\n/**\n * Get the component name from the story context\n */\nfunction getComponentName(context: StoryContext): string {\n  const { component, title } = context;\n  \n  // Try to get name from component\n  if (component) {\n    if (component.displayName) return component.displayName;\n    if (component.name && component.name !== 'default') return component.name;\n    if (component.__docgenInfo?.displayName) return component.__docgenInfo.displayName;\n  }\n  \n  // Fall back to extracting from title (e.g., \"Components/HeroSection\" -> \"HeroSection\")\n  const parts = title.split('/');\n  return parts[parts.length - 1];\n}\n\n/**\n * Format a prop value for Astro template syntax\n */\nfunction formatPropValue(value: unknown): string {\n  if (typeof value === 'string') {\n    // Escape quotes in strings\n    const escaped = value.replace(/\"/g, '\\\\\"');\n    return `\"${escaped}\"`;\n  }\n  \n  if (typeof value === 'number' || typeof value === 'boolean') {\n    return `{${value}}`;\n  }\n  \n  if (value === null || value === undefined) {\n    return `{${value}}`;\n  }\n  \n  if (Array.isArray(value) || typeof value === 'object') {\n    // For complex values, use JSX expression syntax\n    return `{${JSON.stringify(value, null, 2)}}`;\n  }\n  \n  return `{${String(value)}}`;\n}\n\n/**\n * Format props as Astro component attributes\n */\nfunction formatProps(args: Record<string, unknown>, indent: string = '  '): string {\n  const entries = Object.entries(args).filter(([_, value]) => value !== undefined);\n  \n  if (entries.length === 0) {\n    return '';\n  }\n  \n  // For single short prop, keep it inline\n  if (entries.length === 1) {\n    const [key, value] = entries[0];\n    const formatted = formatPropValue(value);\n    if (formatted.length < 40) {\n      return ` ${key}=${formatted}`;\n    }\n  }\n  \n  // For multiple props or long values, format multiline\n  return '\\n' + entries\n    .map(([key, value]) => `${indent}${key}=${formatPropValue(value)}`)\n    .join('\\n') + '\\n';\n}\n\n/**\n * Transform story source code to Astro syntax\n * \n * @param code - The original source code (usually just args object)\n * @param context - The story context with component and args info\n * @returns Formatted Astro component code\n */\nexport function transformSource(code: string, context: StoryContext): string {\n  // If custom source is provided, use it\n  if (context.parameters?.docs?.source?.code) {\n    return context.parameters.docs.source.code;\n  }\n  \n  const componentName = getComponentName(context);\n  const { args } = context;\n  \n  // Handle empty args\n  if (!args || Object.keys(args).length === 0) {\n    return `---\nimport ${componentName} from '../components/${componentName}.astro';\n---\n\n<${componentName} />`;\n  }\n  \n  const propsString = formatProps(args);\n  const selfClosing = !propsString.includes('\\n');\n  \n  if (selfClosing) {\n    return `---\nimport ${componentName} from '../components/${componentName}.astro';\n---\n\n<${componentName}${propsString} />`;\n  }\n  \n  return `---\nimport ${componentName} from '../components/${componentName}.astro';\n---\n\n<${componentName}${propsString}/>`;\n}\n\n/**\n * Default export for easy importing\n */\nexport default transformSource;\n","/**\n * Astro Integration for Storybook Dev Toolbar App\n * \n * Adds a Storybook icon to the Astro dev toolbar that links to the running Storybook instance.\n */\n\nimport type { AstroIntegration } from 'astro';\nimport { createRequire } from 'module';\nimport { dirname, join } from 'path';\n\nconst require = createRequire(import.meta.url);\n\n// Get the toolbar-app.js path relative to the package root\n// This avoids issues with import.meta.url when bundled\nfunction getToolbarEntrypoint(): string {\n  // Resolve the package.json to find the package root\n  const packageJsonPath = require.resolve('@anthropic/storybook-astro/package.json');\n  const packageRoot = dirname(packageJsonPath);\n  return join(packageRoot, 'dist', 'integration', 'toolbar-app.js');\n}\n\nexport interface StorybookToolbarOptions {\n  /**\n   * The port Storybook is running on\n   * @default 6006\n   */\n  port?: number;\n  \n  /**\n   * The host Storybook is running on\n   * @default 'localhost'\n   */\n  host?: string;\n}\n\n/**\n * Astro integration that adds a Storybook link to the dev toolbar\n */\nexport function storybookDevToolbar(options: StorybookToolbarOptions = {}): AstroIntegration {\n  const { port = 6006, host = 'localhost' } = options;\n  \n  return {\n    name: '@anthropic/storybook-astro/toolbar',\n    hooks: {\n      'astro:config:setup': ({ addDevToolbarApp, command }) => {\n        // Only add in dev mode\n        if (command !== 'dev') return;\n        \n        const entrypointPath = getToolbarEntrypoint();\n        \n        addDevToolbarApp({\n          id: 'storybook-toolbar-app',\n          name: 'Storybook',\n          // Official Storybook icon from https://github.com/storybookjs/brand\n          icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 52 64\" fill=\"none\"><path fill=\"#FF4785\" d=\"M50.273 2.923a3.12 3.12 0 0 1 .006.194v55.766a3.117 3.117 0 0 1-3.15 3.117l-42.14-1.869a3.108 3.108 0 0 1-3.006-2.997L.002 5.955A3.108 3.108 0 0 1 2.953 2.727L37.427.594l-.3 7.027a.466.466 0 0 0 .753.396l2.758-2.07 2.329 1.816a.467.467 0 0 0 .76-.381l-.26-7.155 3.466-.221a3.108 3.108 0 0 1 3.34 2.917Z\"/><path fill=\"#fff\" d=\"M29.403 23.369c0 1.213 8.254.636 9.362-.215 0-8.259-4.477-12.599-12.676-12.599-8.199 0-12.793 4.408-12.793 11.019 0 11.514 15.7 11.734 15.7 18.015 0 1.763-.872 2.81-2.791 2.81-2.5 0-3.489-1.264-3.373-5.561 0-.932-9.536-1.223-9.827 0-.74 10.414 5.815 13.417 13.316 13.417 7.269 0 12.967-3.834 12.967-10.776 0-12.34-15.933-12.01-15.933-18.125 0-2.48 1.861-2.81 2.966-2.81 1.163 0 3.256.203 3.082 4.825Z\"/></svg>`,\n          entrypoint: entrypointPath,\n        });\n      },\n      'astro:server:setup': ({ server }) => {\n        // Inject the Storybook URL into the client via a virtual module\n        server.middlewares.use((req, res, next) => {\n          if (req.url === '/__storybook-config') {\n            res.setHeader('Content-Type', 'application/json');\n            res.end(JSON.stringify({ port, host }));\n            return;\n          }\n          next();\n        });\n      },\n    },\n  };\n}\n\nexport default storybookDevToolbar;\n","/**\n * Storybook Preset for Astro Framework\n * \n * This preset configures Storybook to work with Astro components by:\n * 1. Setting up the Vite builder with Astro-specific plugins\n * 2. Configuring the custom Astro renderer\n * 3. Adding middleware for server-side rendering via Container API\n */\n\nimport { dirname, join } from 'node:path';\nimport { fileURLToPath } from 'node:url';\nimport { createRequire } from 'node:module';\nimport type { FrameworkOptions } from './types/index.js';\nimport type { InlineConfig } from 'vite';\n\nconst __dirname = dirname(fileURLToPath(import.meta.url));\nconst require = createRequire(import.meta.url);\n\n/**\n * Get absolute path to a package\n */\nfunction getAbsolutePath<T extends string>(input: T): T {\n  return dirname(require.resolve(join(input, 'package.json'))) as T;\n}\n\n/**\n * Core Storybook configuration\n */\nexport const core = {\n  builder: getAbsolutePath('@storybook/builder-vite'),\n  renderer: join(__dirname, 'renderer'),\n};\n\n/**\n * Framework name for Storybook\n */\nexport const frameworkName = '@anthropic/storybook-astro' as const;\n\n/**\n * Preview annotations - tells Storybook where to find the render functions\n */\nexport const previewAnnotations = async (input: string[] = []) => {\n  return [\n    ...input,\n    join(__dirname, 'renderer', 'entry-preview.js'),\n  ];\n};\n\ninterface ViteFinalContext {\n  presets: {\n    apply<T>(preset: string): Promise<T>;\n  };\n}\n\n/**\n * Vite configuration for Astro support\n */\nexport async function viteFinal(\n  config: InlineConfig,\n  { presets }: ViteFinalContext\n): Promise<InlineConfig> {\n  const frameworkOptions = await presets.apply<FrameworkOptions>('frameworkOptions');\n  \n  // Dynamic import to avoid bundling issues\n  const { createAstroVitePlugins } = await import('./framework/vite-plugins.js');\n  \n  const astroPlugins = await createAstroVitePlugins(frameworkOptions || {});\n  \n  const existingPlugins = config.plugins || [];\n  const existingOptimizeDeps = config.optimizeDeps || {};\n  const existingSsr = config.ssr || {};\n  \n  return {\n    ...config,\n    plugins: [...existingPlugins, ...astroPlugins],\n    optimizeDeps: {\n      ...existingOptimizeDeps,\n      include: [\n        ...(existingOptimizeDeps.include || []),\n        // Pre-bundle CJS modules that Astro depends on\n        'cssesc',\n        'string-width',\n      ],\n      exclude: [\n        ...(existingOptimizeDeps.exclude || []),\n        'astro',\n        'astro/container',\n      ],\n    },\n    ssr: {\n      ...existingSsr,\n      noExternal: [\n        ...(Array.isArray(existingSsr.noExternal) ? existingSsr.noExternal : []),\n        '@anthropic/storybook-astro',\n      ],\n    },\n  };\n}\n\n/**\n * Default export for preset auto-detection\n */\nexport default {\n  core,\n  viteFinal,\n  frameworkName,\n  previewAnnotations,\n};\n"]}